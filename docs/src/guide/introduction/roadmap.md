# 路线图

## 北向（Northward）

### 断网续传（Disk WAL + 回放）

- **目标**：弱网/断链/掉电场景下尽量保障关键数据的交付完整性，并让用户可按现场约束选择“内存/磁盘/混合”缓冲方案
- **关键点**：
  - `bufferType` 可配置（Memory / DiskWal / Hybrid）
  - WAL 落盘格式与目录布局（可升级、可审计）
  - 磁盘配额与清理策略（防止占满磁盘影响系统）
  - 回放限速与实时链路隔离（避免历史补传挤占实时吞吐）
  - 指标与告警（回放 backlog、回放速率、丢弃原因）

### 队列满智能降级（QoS 降级）

- **目标**：在下游拥塞时以可控方式降级，优先保护网关稳定性与关键业务
- **方向**：
  - QoS 与断网续传一体化：离线/拥塞/队列满共用同一套“TTL → last 合并 → 采样 → 准入（内存/WAL）→ 回放预算”策略引擎
  - 丢弃/采样/按 last 合并/按 TTL 过期丢弃（按数据类型/时效性）
  - 按优先级保留（控制面/告警优先）
  - 实时/回放隔离（两条逻辑通道 + 发送预算占比/令牌桶限速）
  - 可观测的丢弃原因拆分与分位数队列深度

### HTTP / WebSocket 北向连接器

- **目标**：支持面向自研服务的轻量对接（同时保持可控重试与背压）
- **方向**：
  - `EnvelopeJson` 作为稳定消息包络
  - 断链重连与会话恢复
  - 鉴权（Token/JWT/mTLS）与多租户隔离
  - 幂等与去重（按事件类型可选）

### 二进制 payload（Protobuf / Avro）

- **目标**：在超大规模点位/高频上报场景显著降低带宽与 CPU
- **方向**：
  - 稳定包络（schemaVersion/schemaId/contentType/encoding）
  - Schema 管理与版本兼容策略（向后兼容）
  - 灰度与回滚（双写/旁路验证）
